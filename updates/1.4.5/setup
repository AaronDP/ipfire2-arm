#!/bin/bash

UPGRADEVERSION="1.4.5"
PREVIOUSVERSION="1.4.4"
echo "This is the $UPGRADEVERSION update patch for IPCop $PREVIOUSVERSION installing."

CURRENTVERSION=`cat /etc/issue | awk '{ print $2 }' | sed -e 's/v//'`

if [ "$CURRENTVERSION" != "$PREVIOUSVERSION" ]; then
	echo "You are not running IPCop v$PREVIOUSVERSION for this patch to install."
	echo "Aborting installation."
	exit -1
fi


/bin/sed -i -e "s+= '1.4.*$+= '$UPGRADEVERSION';+" /var/ipcop/general-functions.pl
# Fix typo in PrintActualLeases subroutine
/bin/sed -i -e 's/colourbox/table2colour/' /var/ipcop/header.pl
/bin/tar -zxpf patch.tar.gz -C /

