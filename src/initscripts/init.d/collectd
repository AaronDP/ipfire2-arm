#!/bin/sh
# Begin $rc_base/init.d/collecd


. /etc/sysconfig/rc
. $rc_functions

case "$1" in
	start)
		boot_mesg "Starting Collection daemon..."
		/usr/sbin/collectd -C /etc/collectd.conf
		evaluate_retval
#
# These lines are for furhter implementation of the collectd, atm the temps are
# collected by the makegraphs script because of the standby functions
#
#		for disk in `kudzu -qps -c HD | grep device: | cut -d" " -f2 | sort | uniq`; do boot_mesg "Bringing up hddtemp daemon for $disk ..."; /usr/sbin/hddtemp $disk -d -l localhost; evaluate_retval; done
#
# Starting the mbmon in deamon mode to enable sensors reading for collectd
# later mbmon will be replaced by lmsensors, if mbmon is not running on your
# system, we advise to comment out these lines in order to prevent fail
#
#		boot_mesg "Bringing up mbmon daemon..."
#		/usr/bin/mbmon -P 411 -r
#		evaluate_retval

		;;

	stop)
# if mbmon is not running on your system, we advise to comment out these lines
# in order to prevent fail
		boot_mesg "Stopping mbmon daemon..."
		killproc /usr/bin/mbmon
		evaluate_retval
#		boot_mesg "Stopping hddtemp daemon..."
#		killproc /usr/sbin/hddtemp
#		evaluate_retval
		boot_mesg "Stopping Collection daemon..."
		killproc /usr/sbin/collectd
		evaluate_retval
		;;

	restart)

#
# We need to do this that way because mbmon doesn`t clear the port when killed
# so the next startup it fails with port allready in use -> donÂ´t restart mbmon
#
		boot_mesg "Stopping Collection daemon..."
		killproc /usr/sbin/collectd
		evaluate_retval
		sleep 1
		boot_mesg "Starting Collection daemon..."
		/usr/sbin/collectd -C /etc/collectd.conf
		evaluate_retval
				;;

	status)
		statusproc /usr/sbin/collectd
		;;

	*)
		echo "Usage: $0 {start|stop|restart|status}"
		exit 1
		;;
esac

# End $rc_base/init.d/collectd
