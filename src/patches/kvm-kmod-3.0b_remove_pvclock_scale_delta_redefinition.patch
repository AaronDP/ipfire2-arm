diff -Naur kvm-kmod-3.0b.org/x86/external-module-compat.h kvm-kmod-3.0b/x86/external-module-compat.h
--- kvm-kmod-3.0b.org/x86/external-module-compat.h	2011-07-23 16:39:10.000000000 +0200
+++ kvm-kmod-3.0b/x86/external-module-compat.h	2011-08-13 21:37:56.046677541 +0200
@@ -1095,7 +1095,7 @@
 
 #endif /* >= 2.6.36 */
 
-#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,37) || \
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,37) && \
     (LINUX_VERSION_CODE == KERNEL_VERSION(2,6,32) && KERNEL_EXTRAVERSION < 40)
 static inline u64 pvclock_scale_delta(u64 delta, u32 mul_frac, int shift)
 {
