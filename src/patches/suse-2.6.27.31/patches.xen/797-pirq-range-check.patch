From: http://xenbits.xensource.com/linux-2.6.18-xen.hg?rev/2f1b770d84e5
# HG changeset 797,804 patch
# User Keir Fraser <keir.fraser@citrix.com>
# Date 1234870273 0
# Node ID 2f1b770d84e54f76185181b0cc74337bf79a2a83
# Parent  f0db1ac7ca8d55defe710ab0539bdc8578772677
Subject: linux/x86: fix off-by-one error in the pirq range checks
Patch-mainline: obsolete

Signed-off-by: Jan Beulich <jbeulich@novell.com>

From: http://xenbits.xensource.com/linux-2.6.18-xen.hg?rev/f3de83c4677f
Subject: linux/evtchn: fix off-by-one error in the pirq range check

Signed-off-by: Jan Beulich <jbeulich@novell.com>

--- sle11-2009-03-16.orig/arch/x86/kernel/io_apic_32-xen.c	2009-03-16 16:13:42.000000000 +0100
+++ sle11-2009-03-16/arch/x86/kernel/io_apic_32-xen.c	2009-03-16 16:13:45.000000000 +0100
@@ -1220,7 +1220,7 @@ int assign_irq_vector(int irq)
 
 	BUG_ON(irq != AUTO_ASSIGN && (unsigned)irq >= NR_IRQ_VECTORS);
 
-	if (irq < PIRQ_BASE || irq - PIRQ_BASE > NR_PIRQS)
+	if (irq < PIRQ_BASE || irq - PIRQ_BASE >= NR_PIRQS)
 		return -EINVAL;
 
 	spin_lock_irqsave(&vector_lock, flags);
--- sle11-2009-03-16.orig/arch/x86/kernel/io_apic_64-xen.c	2009-03-16 16:13:42.000000000 +0100
+++ sle11-2009-03-16/arch/x86/kernel/io_apic_64-xen.c	2009-03-16 16:13:45.000000000 +0100
@@ -895,7 +895,7 @@ int assign_irq_vector(int irq)
   
   	BUG_ON(irq != AUTO_ASSIGN && (unsigned)irq >= NR_IRQ_VECTORS);
 
-	if (irq < PIRQ_BASE || irq - PIRQ_BASE > NR_PIRQS)
+	if (irq < PIRQ_BASE || irq - PIRQ_BASE >= NR_PIRQS)
 		return -EINVAL;
 
 	spin_lock_irqsave(&vector_lock, flags);
--- sle11-2009-03-16.orig/drivers/xen/core/evtchn.c	2009-03-16 16:06:43.000000000 +0100
+++ sle11-2009-03-16/drivers/xen/core/evtchn.c	2009-03-16 16:14:12.000000000 +0100
@@ -1077,7 +1077,7 @@ void irq_resume(void)
 
 void evtchn_register_pirq(int irq)
 {
-	BUG_ON(irq < PIRQ_BASE || irq - PIRQ_BASE > NR_PIRQS);
+	BUG_ON(irq < PIRQ_BASE || irq - PIRQ_BASE >= NR_PIRQS);
 	if (identity_mapped_irq(irq) || type_from_irq(irq) != IRQT_UNBOUND)
 		return;
 	irq_info[irq] = mk_irq_info(IRQT_PIRQ, irq, 0);
