From: wengang wang <wen.gang.wang@oracle.com>
Date: Fri, 13 Feb 2009 10:11:47 +0800
Subject: [PATCH] ocfs2: add IO error check in ocfs2_get_sector()
Patch-mainline: 2.6.29

Check for IO error in ocfs2_get_sector().

Signed-off-by: Wengang Wang <wen.gang.wang@oracle.com>
Signed-off-by: Mark Fasheh <mfasheh@suse.com>
---
 fs/ocfs2/super.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

Index: linux-2.6.27-sle11_ocfs2_update2/fs/ocfs2/super.c
===================================================================
--- linux-2.6.27-sle11_ocfs2_update2.orig/fs/ocfs2/super.c
+++ linux-2.6.27-sle11_ocfs2_update2/fs/ocfs2/super.c
@@ -1538,6 +1538,13 @@ static int ocfs2_get_sector(struct super
 	unlock_buffer(*bh);
 	ll_rw_block(READ, 1, bh);
 	wait_on_buffer(*bh);
+	if (!buffer_uptodate(*bh)) {
+		mlog_errno(-EIO);
+		brelse(*bh);
+		*bh = NULL;
+		return -EIO;
+	}
+
 	return 0;
 }
 
